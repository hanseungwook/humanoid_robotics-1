Index: cmake/SearchForStuff.cmake
===================================================================
--- cmake/SearchForStuff.cmake	(revision 8967)
+++ cmake/SearchForStuff.cmake	(working copy)
@@ -17,6 +17,12 @@
 set (bullet_lflags "" CACHE STRING "Bullet lflags Use this to override automatic detection.")
 set (bullet_cflags "-DBT_USE_DOUBLE_PRECISION -DBT_EULER_DEFAULT_ZYX" CACHE STRING "Bullet Dynamics C compile flags exported by rospack.")
 
+set (parallel_quickstep_include_dirs "" CACHE STRING "parallel_quickstep include paths. Use this to override automatic detection.")
+set (parallel_quickstep_library_dirs "" CACHE STRING "parallel_quickstep library paths. Use this to override automatic detection.")
+set (parallel_quickstep_library "" CACHE STRING "parallel_quickstep CUDA library names. Use this to override automatic detection.")
+set (parallel_quickstep_lflags "" CACHE STRING "parallel_quickstep lflags Use this to override automatic detection.")
+set (parallel_quickstep_cflags "" CACHE STRING "parallel_quickstep cflags Use this to override automatic detection.")
+
 set (threadpool_include_dirs "" CACHE STRING "Threadpool include paths. Use this to override automatic detection.")
 
 SET (gazebo_lflags "" CACHE STRING "Linker flags such as rpath for gazebo executable.")
@@ -380,6 +386,9 @@
 IF (PROFILER)
   SET (CMAKE_LINK_FLAGS_PROFILE "${CMAKE_LINK_FLAGS_PROFILE} -lprofiler" 
        CACHE INTERNAL "Link flags for profile" FORCE)
+  SET (USE_PROFILER ON CACHE BOOL "Found profiler" FORCE)
+ELSE (PROFILER)
+  SET (USE_PROFILER OFF CACHE BOOL "Did not found profiler" FORCE)
 ENDIF (PROFILER)
 
 ########################################
@@ -579,4 +588,46 @@
   endif (NOT BULLET_DOUBLE_PRECISION)
 endif (INCLUDE_BULLET)
 
+########################################
+# Find parallel_quickstep
+STRING(REPLACE " " ";" parallel_quickstep_include_dirs_search_path ${parallel_quickstep_include_dirs})
+find_path( parallel_quickstep_include_found
+    NAMES parallel_quickstep.h parallel_quickstep/parallel_quickstep.h
+    PATHS ${parallel_quickstep_include_dirs_search_path}
+    DOC "parallel_quickstep includes location"
+    NO_DEFAULT_PATH
+    )
+if (NOT parallel_quickstep_include_found)
+  message (STATUS "Looking for parallel_quickstep.h in ${parallel_quickstep_include_dirs_search_path} - not found ${parallel_quickstep_include_found}")
+else (NOT parallel_quickstep_include_found)
+  message (STATUS "Looking for parallel_quickstep.h - found")
+endif (NOT parallel_quickstep_include_found)
 
+
+STRING(REPLACE " " ";" parallel_quickstep_library_dirs_search_path ${parallel_quickstep_library_dirs})
+find_library(parallel_quickstep_library_found parallel_quickstep ${parallel_quickstep_library_dirs_search_path} )
+if (NOT parallel_quickstep_library_found)
+  message (STATUS "Looking for libparallel_quickstep.so in ${parallel_quickstep_library_dirs_search_path} - not found")
+else (NOT parallel_quickstep_library_found)
+  message (STATUS "Looking for libparallel_quickstep.so - found")
+endif (NOT parallel_quickstep_library_found)
+
+if (parallel_quickstep_library_found AND parallel_quickstep_include_found)
+  message (STATUS "building gazebo with parallel_quickstep support")
+  SET (PARALLEL_QUICKSTEP ON CACHE BOOL "Build gazebo with parallel_quickstep support" FORCE)
+else (parallel_quickstep_library_found AND parallel_quickstep_include_found)
+  message (STATUS "building gazebo without parallel_quickstep support")
+  SET (PARALLEL_QUICKSTEP OFF CACHE BOOL "Build gazebo without parallel_quickstep support" FORCE)
+  # clear out parallel_quickstep flags if not library or includes found
+  set (parallel_quickstep_include_dirs "" )
+  set (parallel_quickstep_library_dirs "" )
+  set (parallel_quickstep_library "" )
+  set (parallel_quickstep_lflags "" )
+  set (parallel_quickstep_cflags "" )
+endif (parallel_quickstep_library_found AND parallel_quickstep_include_found)
+
+STRING(REPLACE " " ";" parallel_quickstep_include_dirs_split "${parallel_quickstep_include_dirs}")
+set( CMAKE_REQUIRED_INCLUDES ${parallel_quickstep_include_dirs_split} )
+set( CMAKE_REQUIRED_LIBRARIES ${parallel_quickstep_library} )
+set( CMAKE_REQUIRED_FLAGS  ${parallel_quickstep_lflags} )
+ 
Index: gazebo_config.h.in
===================================================================
--- gazebo_config.h.in	(revision 8967)
+++ gazebo_config.h.in	(working copy)
@@ -16,5 +16,6 @@
 #cmakedefine INCLUDE_ODE 1
 #cmakedefine INCLUDE_ODE_JOINT_DAMPING 1
 #cmakedefine QUICKSTEP_EXPERIMENTAL 1
+#cmakedefine PARALLEL_QUICKSTEP 1
 #cmakedefine INCLUDE_RTSHADER 1
 #cmakedefine ENABLE_TIMERS 1
Index: server/physics/CMakeLists.txt
===================================================================
--- server/physics/CMakeLists.txt	(revision 8967)
+++ server/physics/CMakeLists.txt	(working copy)
@@ -1,5 +1,18 @@
 include (${gazebo_cmake_dir}/GazeboUtils.cmake)
 
+STRING (REPLACE " " ";" parallel_quickstep_include_dirs_split "${parallel_quickstep_include_dirs}")
+STRING (REPLACE " " ";" parallel_quickstep_library_dirs_split "${parallel_quickstep_library_dirs}")
+
+INCLUDE_DIRECTORIES(
+  ${CMAKE_SOURCE_DIR}/libgazebo 
+  ${parallel_quickstep_include_dirs_split}
+)
+
+LINK_DIRECTORIES(  
+ ${CMAKE_BINARY_DIR}/libgazebo 
+ ${parallel_quickstep_library_dirs_split} 
+)
+
 if (INCLUDE_ODE)
   add_subdirectory(ode)
 endif (INCLUDE_ODE)
@@ -55,12 +68,11 @@
 )
 
 add_library(gazebo_physics SHARED ${sources})
+target_link_libraries(gazebo_physics ${LINK_LIBS} )
 
 if (CMAKE_LINK_FLAGS_${CMAKE_BUILD_TYPE})
-  set_source_files_properties(${sources} PROPERTIES LINK_FLAGS 
-    ${CMAKE_LINK_FLAGS_${CMAKE_BUILD_TYPE}})
-  set_target_properties(gazebo_physics PROPERTIES LINK_FLAGS 
-    ${CMAKE_LINK_FLAGS_${CMAKE_BUILD_TYPE}})
+  set_source_files_properties(${sources} PROPERTIES LINK_FLAGS ${CMAKE_LINK_FLAGS_${CMAKE_BUILD_TYPE}})
+  set_target_properties(gazebo_physics PROPERTIES LINK_FLAGS ${CMAKE_LINK_FLAGS_${CMAKE_BUILD_TYPE}} ${parallel_quickstep_lflags})
 endif (CMAKE_LINK_FLAGS_${CMAKE_BUILD_TYPE})
 
 install ( TARGETS gazebo_physics DESTINATION ${CMAKE_INSTALL_PREFIX}/lib )
Index: server/physics/ode/ODEPhysics.hh
===================================================================
--- server/physics/ode/ODEPhysics.hh	(revision 8967)
+++ server/physics/ode/ODEPhysics.hh	(working copy)
@@ -38,6 +38,10 @@
 #include <boost/thread/thread.hpp>
 #include <boost/thread/mutex.hpp>
 
+#ifdef PARALLEL_QUICKSTEP
+#include <parallel_quickstep/parallel_quickstep.h>
+#endif
+
 namespace gazebo
 {
   class Entity;
Index: server/physics/ode/CMakeLists.txt
===================================================================
--- server/physics/ode/CMakeLists.txt	(revision 8967)
+++ server/physics/ode/CMakeLists.txt	(working copy)
@@ -1,5 +1,17 @@
 include (${gazebo_cmake_dir}/GazeboUtils.cmake)
 
+STRING (REPLACE " " ";" parallel_quickstep_include_dirs_split "${parallel_quickstep_include_dirs}")
+STRING (REPLACE " " ";" parallel_quickstep_library_dirs_split "${parallel_quickstep_library_dirs}")
+
+include_directories(
+  ${parallel_quickstep_include_dirs_split}
+)
+
+link_directories(
+ ${parallel_quickstep_library_dirs_split} 
+)
+
+
 SET (sources ODEPhysics.cc
              ODEGeom.cc
              ODEBody.cc
@@ -41,6 +53,7 @@
 
 LIST_TO_STRING(MY_ODE_CFLAGS "${ODE_CFLAGS}")
 
-set_target_properties(gazebo_physics_ode PROPERTIES COMPILE_FLAGS "-fPIC ${MY_ODE_CFLAGS}")
-target_link_libraries( gazebo_physics_ode ${ODE_LIBRARIES})
+add_definitions(${parallel_quickstep_cflags})
+set_target_properties( gazebo_physics_ode PROPERTIES COMPILE_FLAGS "-fPIC ${MY_ODE_CFLAGS}" )
+target_link_libraries( gazebo_physics_ode ${ODE_LIBRARIES} ${parallel_quickstep_lflags} )
 install ( TARGETS gazebo_physics_ode DESTINATION ${CMAKE_INSTALL_PREFIX}/lib )
Index: server/physics/ode/ODEPhysics.cc
===================================================================
--- server/physics/ode/ODEPhysics.cc	(revision 8967)
+++ server/physics/ode/ODEPhysics.cc	(working copy)
@@ -54,6 +54,8 @@
 #include "ODEHeightmapShape.hh"
 #include "MapShape.hh"
 
+#include "gazebo_config.h"
+
 #include "ODEPhysics.hh"
 
 using namespace gazebo;
@@ -445,6 +447,10 @@
       dWorldQuickStep(this->worldId, (**this->stepTimeP).Double());
     else if (**this->stepTypeP == "world")
       dWorldStep( this->worldId, (**this->stepTimeP).Double() );
+#ifdef PARALLEL_QUICKSTEP
+    else if (**this->stepTypeP == "parallel_quick")
+      dWorldParallelQuickStep(this->worldId, (**this->stepTimeP).Double());  
+#endif
     else
       gzthrow(std::string("Invalid step type[") + **this->stepTypeP);
 
Index: server/CMakeLists.txt
===================================================================
--- server/CMakeLists.txt	(revision 8967)
+++ server/CMakeLists.txt	(working copy)
@@ -5,10 +5,12 @@
 string (REPLACE " " ";" boost_include_dirs_split "${boost_include_dirs}")
 string (REPLACE " " ";" assimp_include_dirs_split "${assimp_include_dirs}")
 string (REPLACE " " ";" bullet_include_dirs_split "${bullet_include_dirs}")
+string (REPLACE " " ";" parallel_quickstep_include_dirs_split "${parallel_quickstep_include_dirs}")
 string (REPLACE " " ";" threadpool_include_dirs_split "${threadpool_include_dirs}")
 string (REPLACE " " ";" boost_library_dirs_split "${boost_library_dirs}")
 string (REPLACE " " ";" assimp_library_dirs_split "${assimp_library_dirs}")
 string (REPLACE " " ";" bullet_library_dirs_split "${bullet_library_dirs}")
+string (REPLACE " " ";" parallel_quickstep_library_dirs_split "${parallel_quickstep_library_dirs}")
 
 
 include_directories(
@@ -35,6 +37,7 @@
   ${assimp_include_dirs_split}
   ${freeimage_include_dir}
   ${bullet_include_dirs_split}
+  ${parallel_quickstep_include_dirs_split}
   ${threadpool_include_dirs_split}
   ${FLTK_INCLUDE_DIR}
 )
@@ -46,6 +49,7 @@
  ${boost_library_dirs_split} 
  ${assimp_library_dirs_split} 
  ${bullet_library_dirs_split} 
+ ${parallel_quickstep_library_dirs_split} 
  ${freeimage_library_dir}
  ${gazeboserver_link_dirs} 
 )
@@ -196,8 +200,8 @@
 endif (INCLUDE_BULLET)
 
 if (INCLUDE_ODE)
-  target_link_libraries(gazebo_server gazebo_physics_ode ${ODE_LIBRARIES})
-  target_link_libraries(gazebo-exec gazebo_physics_ode ${ODE_LIBRARIES})
+  target_link_libraries(gazebo_server ${parallel_quickstep_lflags} gazebo_physics_ode ${ODE_LIBRARIES})
+  target_link_libraries(gazebo-exec ${parallel_quickstep_lflags} gazebo_physics_ode ${ODE_LIBRARIES})
   APPEND_TO_CACHED_LIST(gazeboserver_ldflags 
                       ${gazeboserver_ldflags_desc} 
                       -lgazebo_physics_ode)
Index: server/rendering/OgreCamera.cc
===================================================================
--- server/rendering/OgreCamera.cc	(revision 8967)
+++ server/rendering/OgreCamera.cc	(working copy)
@@ -99,6 +99,8 @@
   this->origParentNode = NULL;
 
   this->viewController = new FPSViewController(this);
+
+  this->lastRenderTime = Simulator::Instance()->GetSimTime();
 }
 
 //////////////////////////////////////////////////////////////////////////////
@@ -438,6 +440,9 @@
 void OgreCamera::SetFOV( float radians )
 {
   this->hfovP->SetValue(radians);
+
+  float vfov = radians * this->imageSizeP->GetValue().y / this->imageSizeP->GetValue().x;
+  if (this->camera) this->camera->setFOVy(Ogre::Radian(vfov));
 }
 
 
Index: server/rendering/OgreCamera.hh
===================================================================
--- server/rendering/OgreCamera.hh	(revision 8967)
+++ server/rendering/OgreCamera.hh	(working copy)
@@ -308,6 +308,7 @@
 
     private: ViewController *viewController;
 
+    public: Time GetLastRenderTime() {return this->lastRenderTime;};
     protected: Time lastRenderTime;
 
   };
